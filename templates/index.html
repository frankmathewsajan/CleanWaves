{% extends 'layout.html' %}
{% load static %}
{% block navhead %}<i>{% if user.first_name %}{{ user.first_name }}{% else %}{{ user.username }}{% endif %}</i>{% endblock %}
{% block body %}
    <main class="flex-grow flex flex-col justify-center items-center">
        <!-- Space for animation -->
        <div id="animation-container" class="relative w-full h-96 mb-8 overflow-hidden">
            <img src="{% static 'imgs/river_bg.jpg' %}" alt="River Background" class="absolute inset-0 w-full h-full object-cover">
            <div id="boat" class="absolute w-12 h-12 bg-blue-500 rounded-full shadow-lg flex items-center justify-center">
                <div class="w-8 h-8 bg-yellow-400 rounded-full"></div>
            </div>
        </div>

        <div class="flex space-x-4">
            <button class="px-6 py-2 bg-blue-500 text-white rounded-full font-semibold shadow-lg"
                    onclick="location.href=`{% url 'dashboard' %}`">
                Draw Path <br><span class="text-sm">for waste collection</span>
            </button>
            <button class="px-6 py-2 bg-green-500 text-white rounded-full font-semibold shadow-lg"
                    onclick="location.href=`{% url 'index' %}`">
                Track <br><span class="text-sm">the robot</span>
            </button>
        </div>
    </main>

    <script>
        const boat = document.getElementById('boat');
        const container = document.getElementById('animation-container');
        const containerWidth = container.offsetWidth;
        const containerHeight = container.offsetHeight;

        let posX = containerWidth / 2; // Start at the center of the container
        let posY = containerHeight / 2;

        function getRandomDirection() {
            const directions = [
                { x: 1, y: 0 },   // Right
                { x: -1, y: 0 },  // Left
                { x: 0, y: 1 },   // Down
                { x: 0, y: -1 },  // Up
                { x: 1, y: 1 },   // Diagonal Down-Right
                { x: -1, y: -1 }, // Diagonal Up-Left
                { x: 1, y: -1 },  // Diagonal Up-Right
                { x: -1, y: 1 }   // Diagonal Down-Left
            ];
            return directions[Math.floor(Math.random() * directions.length)];
        }

        function animateBoat() {
            const direction = getRandomDirection();
            const step = 10; // Movement step size

            posX += direction.x * step;
            posY += direction.y * step;

            // Boundary check
            if (posX < 0) posX = 0;
            if (posY < 0) posY = 0;
            if (posX > containerWidth - 48) posX = containerWidth - 48; // 48px = boat size
            if (posY > containerHeight - 48) posY = containerHeight - 48;

            boat.style.transform = `translate(${posX}px, ${posY}px)`;

            // Recursive animation with delay
            setTimeout(animateBoat, 300);
        }

        animateBoat();
    </script>
{% endblock %}
